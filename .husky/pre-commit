#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-commit hook - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

echo "üîç –í—ã–ø–æ–ª–Ω—è—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è —Ñ–∞–π–ª—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏
if git diff --cached --name-only | grep -E '\.(env|key|secret)$'; then
  echo "‚ùå –û—à–∏–±–∫–∞: –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å —Ñ–∞–π–ª—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏!"
  echo "   –£–¥–∞–ª–∏—Ç–µ —ç—Ç–∏ —Ñ–∞–π–ª—ã –∏–∑ –∫–æ–º–º–∏—Ç–∞ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ .gitignore"
  exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (–Ω–µ –±–æ–ª–µ–µ 10MB)
git diff --cached --name-only | while read file; do
  if [ -f "$file" ]; then
    size=$(stat -f%z "$file" 2>/dev/null || stat -c%s "$file" 2>/dev/null || echo 0)
    if [ "$size" -gt 10485760 ]; then
      echo "‚ùå –û—à–∏–±–∫–∞: –§–∞–π–ª $file —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (>10MB)"
      echo "   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Git LFS –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤"
      exit 1
    fi
  fi
done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –∫–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
if git diff --cached | grep -E '(console\.log|debugger|TODO|FIXME)' | grep -vE '^\+.*//'; then
  echo "‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –û–±–Ω–∞—Ä—É–∂–µ–Ω –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –∫–æ–¥ (console.log, debugger)"
  echo "   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª—É—á–∞–π–Ω–æ"
fi

echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!"

